---
layout: post
title: commons-logging classloader pain
date: '2005-06-18T07:52:00.000-04:00'
author: Bill Schneider
tags: 
modified_time: '2005-06-18T08:13:23.706-04:00'
blogger_id: tag:blogger.com,1999:blog-9159309.post-111909637844779466
blogger_orig_url: http://wrschneider.blogspot.com/2005/06/commons-logging-classloader-pain_18.html
---

I recently learned about commons-logging's classloader behavior the hard way when moving applications that use log4j from Tomcat to WebLogic.  I had naively put commons-logging.jar in my WebLogic system classpath to emulate Tomcat's behavior, and things subsequently broke.  This web site provided a very detailed and erudite explanation:<br /><br /><a href="http://www.qos.ch/logging/classloader.jsp">http://www.qos.ch/logging/classloader.jsp</a><br /><br />Basically, it boils down to weird subtlety in commons-logging's behavior.  If commons-logging.jar is in the system classpath in a J2EE environment, the "current" or "thread context" classloader for each individual webapp contains WEB-INF/lib, but commons-logging itself is loaded in the system (parent) classpath.  commons-logging looks for log4j using the thread-context classloader and therefore will "see" log4j in WEB-INF/lib, but tries to actually load it in the system classpath, and breaks with a NoClassDefFoundError.    <br /><br />Various solutions:<br /><ul><br />  <li>Only put commons-logging-api.jar in the system classpath, as Tomcat does.  (I didn't realize there were two different variations of the JAR at first.  I know, RTFM.)  This stripped-down commons-logging will  pretend that log4j doesn't exist.  Downside: logging output from third-party APIs like Hibernate, Digester, etc. will go who-knows-where, but not the same place as your application's log4j output.<br /><br />  <li>Put log4j in the system classpath too.  This works, but has the bad side effect that all applications will share a single log4j configuration and this makes logging unmanageable.<br /><br />  <li>Put commons-logging.jar in your WEB-INF/lib directory.  I'd heard bad things about this, especially if you want to deploy the same WAR in Tomcat.  But for whatever reason it worked fine with Tomcat 4.1.31 and WebLogic 8.1.  So this may be my preferred solution.<br /><br /></ul><br /><br />Anyhow, if this was confusing to someone who has been doing J2EE professionally for 5-6 years, I can imagine how confusing it must be to someone just trying to do this for the first time.  The <a href="http://www.jroller.com/page/fate/?anchor=the_evils_of_commons_logging">BileBlog</a> puts it a lot less charitably.